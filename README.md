# CUDA Image Processing Library

**–ö—É—Ä—Å–æ–≤–æ–π –ø—Ä–æ–µ–∫—Ç –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ "–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ"**  
–ö–æ–º–∞–Ω–¥–∞ –∏–∑ 4 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ | –°—Ä–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: 2 –Ω–µ–¥–µ–ª–∏

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **CUDA**. –¶–µ–ª—å ‚Äî –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –Ω–∞ GPU –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç–∏–ø–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
4. [–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—Å–±–æ—Ä–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
5. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ-–¥–µ—Ç–∞–ª–∏-–∏-–∞–ª–≥–æ—Ä–∏—Ç–º—ã)
   - [–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ](#1-–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ-–≤-–æ—Ç—Ç–µ–Ω–∫–∏-—Å–µ—Ä–æ–≥–æ-grayscale)
   - [–ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è](#2-–ø–æ–≤–æ—Ä–æ—Ç-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è-rotation)
   - [–†–∞–∑–º—ã—Ç–∏–µ](#3-—Ä–∞–∑–º—ã—Ç–∏–µ-blur)
   - [–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞](#4-–ø–∞–∫–µ—Ç–Ω–∞—è-–æ–±—Ä–∞–±–æ—Ç–∫–∞-batch-processing)
6. [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](#–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
7. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ** (`grayscale`) - 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π, –≤–∑–≤–µ—à–µ–Ω–Ω—ã–π, in-place)
- **–ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** (`rotation`) - 90¬∞, 180¬∞, 270¬∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π —É–≥–æ–ª
- **–†–∞–∑–º—ã—Ç–∏–µ** (`blur`) - Box, Gaussian, Separable Gaussian, Motion blur
- **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
- **–ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** (Pipeline) - —É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º 3-—ç—Ç–∞–ø–Ω–æ–≥–æ –∫–æ–Ω–≤–µ–π–µ—Ä–∞:
  - –≠—Ç–∞–ø 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –¥–∏—Å–∫–∞ (CPU –ø–æ—Ç–æ–∫–∏)
  - –≠—Ç–∞–ø 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ GPU (4 CUDA streams –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)
  - –≠—Ç–∞–ø 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –¥–∏—Å–∫ (CPU –ø–æ—Ç–æ–∫–∏)
  - –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 20-30% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω–æ–π –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**: –î–æ–±–∞–≤–ª–µ–Ω `ParallelProcessor` –∫–ª–∞—Å—Å –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CUDA streams
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏**: –£–ª—É—á—à–µ–Ω–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPU –ø–∞–º—è—Ç—å—é —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º pinned memory –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö transfers
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–∞ GPU —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö CUDA-—è–¥–µ—Ä. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º–∞—Ç—ã PNG, JPG, BMP —á–µ—Ä–µ–∑ STB –±–∏–±–ª–∏–æ—Ç–µ–∫—É.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
PProgramming_MultithreadedImageProcessing/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ core/                   # –Ø–¥—Ä–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_processor.cu  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPU –ø–∞–º—è—Ç—å—é, CUDA –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_processor.h   # –ü—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (ImageData, ImageProcessor)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cuda_kernels.cu     # –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ CUDA —è–¥—Ä–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cuda_utils.h        # –ú–∞–∫—Ä–æ—Å—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ CUDA
‚îÇ   ‚îú‚îÄ‚îÄ filters/                # –§–∏–ª—å—Ç—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grayscale.cu        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grayscale.h         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å grayscale —Ñ–∏–ª—å—Ç—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blur.cu             # –†–∞–∑–º—ã—Ç–∏–µ (Box, Gaussian, Separable, Motion)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blur.h              # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å blur —Ñ–∏–ª—å—Ç—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rotation.cu         # –ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (90¬∞, 180¬∞, 270¬∞, –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rotation.h          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å rotation —Ñ–∏–ª—å—Ç—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_loader.cu     # –ó–∞–≥—Ä—É–∑–∫–∞/—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (PNG, JPG, BMP)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_loader.h      # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ batch_processor.cu  # –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ batch_processor.h   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–∞–∫–µ—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stb_image.h         # –í–Ω–µ—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stb_image_write.h   # –í–Ω–µ—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
‚îÇ   ‚îî‚îÄ‚îÄ main.cu                 # –ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (CLI)
‚îú‚îÄ‚îÄ tests/                      # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ test_grayscale.cu       # –¢–µ—Å—Ç—ã grayscale —Ñ–∏–ª—å—Ç—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ test_rotation.cu        # –¢–µ—Å—Ç—ã rotation —Ñ–∏–ª—å—Ç—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ test_blur.cu            # –¢–µ—Å—Ç—ã blur —Ñ–∏–ª—å—Ç—Ä–∞
‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îî‚îÄ‚îÄ cuda_image_lib.h        # –ì–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ samples/                    # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ simple_example.cu       # –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ batch_example.cu        # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ multi_filter_example.cu # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ CMakeLists.txt              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îú‚îÄ‚îÄ run_tests.sh                # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ .gitignore                  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
```

---

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **–û–°**: Linux (Ubuntu 22.04+) –∏–ª–∏ WSL2
- **GPU**: NVIDIA —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ compute capability ‚â• 8.6, –Ω–∞–ø—Ä–∏–º–µ—Ä RTX 4060)
- **CUDA Toolkit**: –≤–µ—Ä—Å–∏—è 12.3 –∏–ª–∏ –≤—ã—à–µ
- **–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä**: GCC 12 (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å CUDA 12.3)
- **–°–±–æ—Ä–∫–∞**: CMake 3.18+
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏**: STB (—Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

---

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ STB –±–∏–±–ª–∏–æ—Ç–µ–∫

```bash
cd src/utils
wget https://raw.githubusercontent.com/nothings/stb/master/stb_image.h
wget https://raw.githubusercontent.com/nothings/stb/master/stb_image_write.h
cd ../..
```

### 2. –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
mkdir -p build && cd build
cmake .. -DCMAKE_CUDA_HOST_COMPILER=/usr/bin/g++-12 \
         -DCMAKE_C_COMPILER=/usr/bin/gcc-12 \
         -DCMAKE_CXX_COMPILER=/usr/bin/g++-12
cmake --build .
```

### 3. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
./run_tests.sh
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

####  –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö)

–ö—Ä–∞—Å–∏–≤—ã–π –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å Drag & Drop:

```bash
cd web
./start_server.sh
# –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:5000
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**
- üìÅ Drag & Drop –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
-  –í—ã–±–æ—Ä —Ñ–∏–ª—å—Ç—Ä–∞ —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
- ‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ä–∞–¥–∏—É—Å —Ä–∞–∑–º—ã—Ç–∏—è)
-  –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–≤—Ä–µ–º—è, —Ä–∞–∑–º–µ—Ä)
- üëÄ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –î–æ/–ü–æ—Å–ª–µ
-  –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

####  –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (CLI)

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
```bash
./build/image_processor grayscale input.png output.png
./build/image_processor rotate90 input.png output.png
./build/image_processor blur input.png output.png 10
```

**–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
```bash
# –û–±—ã—á–Ω–∞—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
./build/image_processor batch grayscale ./images/ ./output/

# –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ë–´–°–¢–†–ï–ï –Ω–∞ 20-30%!)
./build/image_processor batch-pipeline grayscale ./images/ ./output/
```

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è batch/batch-pipeline:**
- `grayscale` - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ
- `blur` - —Ä–∞–∑–º—ã—Ç–∏–µ (—Ä–∞–¥–∏—É—Å 5)
- `rotate90`, `rotate180`, `rotate270` - –ø–æ–≤–æ—Ä–æ—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è batch-pipeline)

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –û–±—ã—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (batch): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å CPU
- –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (batch-pipeline): –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω–≤–µ–π–µ—Ä –∏–∑ 3 —ç—Ç–∞–ø–æ–≤ (–ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí GPU ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ) + 4 CUDA streams
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: ~20-30% –Ω–∞ –±–æ–ª—å—à–∏—Ö –ø–∞–∫–µ—Ç–∞—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

### 1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ (Grayscale)

#### –ü—Ä–æ–±–ª–µ–º–∞:
–¶–≤–µ—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ RGB (3 –∫–∞–Ω–∞–ª–∞ –ø–æ 8 –±–∏—Ç), –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ 1 –∫–∞–Ω–∞–ª (–æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ).

#### –ê–ª–≥–æ—Ä–∏—Ç–º:
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞, —É—á–∏—Ç—ã–≤–∞—é—â–∞—è –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º –≥–ª–∞–∑–æ–º:
```
Gray = 0.299 √ó R + 0.587 √ó G + 0.114 √ó B
```

–ó–µ–ª–µ–Ω—ã–π –∫–∞–Ω–∞–ª –∏–º–µ–µ—Ç –±–æ–ª—å—à–∏–π –≤–µ—Å, —Ç–∞–∫ –∫–∞–∫ —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –≥–ª–∞–∑ –Ω–∞–∏–±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –∑–µ–ª–µ–Ω–æ–º—É —Ü–≤–µ—Ç—É.

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ GPU:

**1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
```cpp
struct ImageData {
    unsigned char* data;      // –î–∞–Ω–Ω—ã–µ –Ω–∞ CPU (host)
    unsigned char* gpu_data;  // –î–∞–Ω–Ω—ã–µ –Ω–∞ GPU (device)
    int width, height, channels;
    size_t size_bytes;
};
```

**2. CUDA kernel (—è–¥—Ä–æ):**
```cpp
__global__ void grayscaleKernel(const unsigned char* input, unsigned char* output,
                                int width, int height, int channels) {
    // –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç 1 –ø–∏–∫—Å–µ–ª—å
    int x = blockIdx.x * blockDim.x + threadIdx.x;  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
    int y = blockIdx.y * blockDim.y + threadIdx.y;  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y
    
    if (x < width && y < height) {
        int idx = (y * width + x) * channels;  // –ò–Ω–¥–µ–∫—Å –≤ –º–∞—Å—Å–∏–≤–µ
        
        unsigned char r = input[idx];
        unsigned char g = input[idx + 1];
        unsigned char b = input[idx + 2];
        
        // –§–æ—Ä–º—É–ª–∞ —Å —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–π –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–æ–π (–±—ã—Å—Ç—Ä–µ–µ)
        unsigned char gray = (77*r + 150*g + 29*b) / 256;
        
        output[y * width + x] = gray;  // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    }
}
```

**3. –ó–∞–ø—É—Å–∫ –Ω–∞ GPU:**
```cpp
// –†–∞–∑–±–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –±–ª–æ–∫–∏ 16√ó16 –ø–∏–∫—Å–µ–ª–µ–π
dim3 blockSize(16, 16);  // 256 –ø–æ—Ç–æ–∫–æ–≤ –≤ –±–ª–æ–∫–µ
dim3 gridSize((width + 15) / 16, (height + 15) / 16);  // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–ª–æ–∫–æ–≤

// –ó–∞–ø—É—Å–∫–∞–µ–º kernel
grayscaleKernel<<<gridSize, blockSize>>>(input_gpu, output_gpu, width, height, channels);
```

**–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º:**
- –î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è 1920√ó1080: **2,073,600 –ø–∏–∫—Å–µ–ª–µ–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
- –ö–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å = 1 –ø–æ—Ç–æ–∫ GPU
- RTX 4060 –∏–º–µ–µ—Ç 3072 CUDA —è–¥—Ä–∞ ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥

---

### 2. –ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Rotation)

#### –ü—Ä–æ–±–ª–µ–º–∞:
–ü–æ–≤–µ—Ä–Ω—É—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ 90¬∞, 180¬∞ –∏–ª–∏ 270¬∞ –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

#### –ê–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞ 90¬∞:

**–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞:**
```
–°—Ç–∞—Ä—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (x, y) ‚Üí –ù–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (x', y')
x' = height - 1 - y
y' = x

–†–∞–∑–º–µ—Ä—ã –º–µ–Ω—è—é—Ç—Å—è: –Ω–æ–≤–∞—è_—à–∏—Ä–∏–Ω–∞ = —Å—Ç–∞—Ä–∞—è_–≤—ã—Å–æ—Ç–∞
                  –Ω–æ–≤–∞—è_–≤—ã—Å–æ—Ç–∞ = —Å—Ç–∞—Ä–∞—è_—à–∏—Ä–∏–Ω–∞
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**
```
–ò—Å—Ö–æ–¥–Ω–æ–µ (3√ó2):        –ü–æ—Å–ª–µ –ø–æ–≤–æ—Ä–æ—Ç–∞ 90¬∞ (2√ó3):
[A B C]                [D A]
[D E F]                [E B]
                       [F C]
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ GPU:

```cpp
__global__ void rotate90Kernel(const unsigned char* input, unsigned char* output,
                               int width, int height, int channels) {
    int x = blockIdx.x * blockDim.x + threadIdx.x;
    int y = blockIdx.y * blockDim.y + threadIdx.y;
    
    if (x < width && y < height) {
        // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        int new_x = height - 1 - y;
        int new_y = x;
        
        // –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ –∫–∞–Ω–∞–ª—ã (RGB)
        for (int c = 0; c < channels; c++) {
            int src_idx = (y * width + x) * channels + c;
            int dst_idx = (new_y * height + new_x) * channels + c;
            output[dst_idx] = input[src_idx];
        }
    }
}
```

**–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º:**
- –ö–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å —á–∏—Ç–∞–µ—Ç—Å—è –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–∞–º—è—Ç–∏ (—Ä–∞–∑–Ω—ã–µ –∞–¥—Ä–µ—Å–∞)
- –î–ª—è 1920√ó1080: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞ ~1-2 –º—Å

---

### 3. –†–∞–∑–º—ã—Ç–∏–µ (Blur)

#### –ü—Ä–æ–±–ª–µ–º–∞:
–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º—ã—Ç–∏–µ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é, —É—Å—Ä–µ–¥–Ω—è—è —Ü–≤–µ—Ç–∞ —Å–æ—Å–µ–¥–Ω–∏—Ö –ø–∏–∫—Å–µ–ª–µ–π.

#### –ê–ª–≥–æ—Ä–∏—Ç–º Box Blur:

**–ò–¥–µ—è:** –ö–∞–∂–¥—ã–π –ø–∏–∫—Å–µ–ª—å –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Å—Ä–µ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–∏–∫—Å–µ–ª–µ–π –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ (–æ–∫–Ω–µ).

**–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞:**
```
–î–ª—è –ø–∏–∫—Å–µ–ª—è (x, y) —Å —Ä–∞–¥–∏—É—Å–æ–º r:
–Ω–æ–≤–æ–µ_–∑–Ω–∞—á–µ–Ω–∏–µ = —Å—Ä–µ–¥–Ω–µ–µ –≤—Å–µ—Ö –ø–∏–∫—Å–µ–ª–µ–π –≤ –æ–±–ª–∞—Å—Ç–∏ [x-r..x+r, y-r..y+r]
```

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (—Ä–∞–¥–∏—É—Å = 1):**
```
–û–∫–Ω–æ 3√ó3:
[A B C]
[D E F]  ‚Üí  E' = (A+B+C+D+E+F+G+H+I) / 9
[G H I]
```

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ GPU:

```cpp
__global__ void boxBlurKernel(const unsigned char* input, unsigned char* output,
                              int width, int height, int channels, int radius) {
    int x = blockIdx.x * blockDim.x + threadIdx.x;
    int y = blockIdx.y * blockDim.y + threadIdx.y;
    
    if (x < width && y < height) {
        for (int c = 0; c < channels; c++) {
            float sum = 0.0f;
            int count = 0;
            
            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –æ–∫–Ω—É [x-radius..x+radius, y-radius..y+radius]
            for (int dy = -radius; dy <= radius; dy++) {
                for (int dx = -radius; dx <= radius; dx++) {
                    int nx = x + dx;
                    int ny = y + dy;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä–∞–Ω–∏—Ü—ã
                    if (nx >= 0 && nx < width && ny >= 0 && ny < height) {
                        int idx = (ny * width + nx) * channels + c;
                        sum += input[idx];
                        count++;
                    }
                }
            }
            
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            int out_idx = (y * width + x) * channels + c;
            output[out_idx] = (unsigned char)(sum / count);
        }
    }
}
```

**–°–ª–æ–∂–Ω–æ—Å—Ç—å:**
- CPU (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ): O(width √ó height √ó radius¬≤)
- GPU (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ): O(radius¬≤) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: –≤ —Ç—ã—Å—è—á–∏ —Ä–∞–∑ –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

---

### 4. –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Batch Processing)

#### –ü—Ä–æ–±–ª–µ–º–∞:
–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ—Ç–Ω–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã CPU –∏ GPU.

#### –ü–æ–¥—Ö–æ–¥ 1: –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (BatchProcessor)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     –ü—É–ª –ø–æ—Ç–æ–∫–æ–≤ (16 –ø–æ—Ç–æ–∫–æ–≤ CPU)        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü–æ—Ç–æ–∫ 1: –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí GPU ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ   ‚îÇ
‚îÇ –ü–æ—Ç–æ–∫ 2: –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí GPU ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ   ‚îÇ
‚îÇ ...                                     ‚îÇ
‚îÇ –ü–æ—Ç–æ–∫ 16: –ó–∞–≥—Ä—É–∑–∫–∞ ‚Üí GPU ‚Üí –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
```cpp
// 1. –°–æ–∑–¥–∞–µ–º –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤
unsigned int num_threads = std::thread::hardware_concurrency();  // 16 –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö CPU

// 2. –ê—Ç–æ–º–∞—Ä–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
std::atomic<size_t> current_index(0);

// 3. –ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
auto worker = [&]() {
    while (true) {
        size_t index = current_index.fetch_add(1);  // –ê—Ç–æ–º–∞—Ä–Ω–æ –±–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ñ–∞–π–ª
        if (index >= files.size()) break;
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª
        ImageData img = load(files[index]);
        apply_filter(img);  // GPU –æ–±—Ä–∞–±–æ—Ç–∫–∞
        save(img, output_files[index]);
    }
};

// 4. –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ—Ç–æ–∫–∏
for (int i = 0; i < num_threads; i++) {
    threads.push_back(std::thread(worker));
}

// 5. –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
for (auto& t : threads) t.join();
```

**–ü—Ä–æ–±–ª–µ–º–∞:** GPU –ø—Ä–æ—Å—Ç–∞–∏–≤–∞–µ—Ç –ø–æ–∫–∞ CPU –∑–∞–≥—Ä—É–∂–∞–µ—Ç/—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª—ã.

---

#### –ü–æ–¥—Ö–æ–¥ 2: –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (Pipeline)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ó–ê–ì–†–£–ó–ö–ê   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   GPU        ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  –°–û–•–†–ê–ù–ï–ù–ò–ï  ‚îÇ
‚îÇ  (CPU –ø–æ—Ç–æ–∫–∏)‚îÇ    ‚îÇ (4 streams)  ‚îÇ    ‚îÇ (CPU –ø–æ—Ç–æ–∫–∏) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚Üì                    ‚Üì                    ‚Üì
  [–û—á–µ—Ä–µ–¥—å 1]         [–û—á–µ—Ä–µ–¥—å 2]
  (–±—É—Ñ–µ—Ä 10)          (–±—É—Ñ–µ—Ä 10)
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

**1. –ü–æ—Ç–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:**
```cpp
void loaderThread() {
    for (—Ñ–∞–π–ª in —Ñ–∞–π–ª—ã) {
        ImageData img = load(—Ñ–∞–π–ª);  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å –¥–∏—Å–∫–∞
        
        // –ñ–¥–µ–º –ø–æ–∫–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –ø–æ—è–≤–∏—Ç—Å—è –º–µ—Å—Ç–æ
        std::unique_lock<std::mutex> lock(queue_mutex);
        queue_cv.wait(lock, [&]() { return load_queue.size() < buffer_size; });
        
        load_queue.push(img);  // –ö–ª–∞–¥–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
        queue_cv.notify_all();  // –°–∏–≥–Ω–∞–ª: "–ï—Å—Ç—å —Ä–∞–±–æ—Ç–∞!"
    }
    done_loading = true;
}
```

**2. –ü–æ—Ç–æ–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (4 –ø–æ—Ç–æ–∫–∞, –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–∏–º CUDA stream):**
```cpp
void processorThread(cudaStream_t stream) {
    while (true) {
        // –ë–µ—Ä–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–≥—Ä—É–∑–∫–∏
        std::unique_lock<std::mutex> lock(load_mutex);
        load_cv.wait(lock, [&]() { return !load_queue.empty() || done_loading; });
        
        if (load_queue.empty() && done_loading) break;
        
        ImageData img = load_queue.front();
        load_queue.pop();
        lock.unlock();
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∞ GPU (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ stream)
        apply_filter_async(img, stream);
        cudaMemcpyAsync(..., stream);  // –ö–æ–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        cudaStreamSynchronize(stream);  // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        
        // –ö–ª–∞–¥–µ–º –≤ –æ—á–µ—Ä–µ–¥—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        save_queue.push(img);
        save_cv.notify_all();
    }
}
```

**3. –ü–æ—Ç–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:**
```cpp
void saverThread() {
    while (true) {
        // –ë–µ—Ä–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        std::unique_lock<std::mutex> lock(save_mutex);
        save_cv.wait(lock, [&]() { return !save_queue.empty() || done_processing; });
        
        if (save_queue.empty() && done_processing) break;
        
        ImageData img = save_queue.front();
        save_queue.pop();
        lock.unlock();
        
        save(img);  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –¥–∏—Å–∫
    }
}
```

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:**
- `std::mutex` - –∑–∞—â–∏—Ç–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –æ—á–µ—Ä–µ–¥—è–º
- `std::condition_variable` - —Å–∏–≥–Ω–∞–ª—ã –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- `std::atomic<bool>` - —Ñ–ª–∞–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (done_loading, done_processing)

**CUDA Streams:**
```cpp
// –°–æ–∑–¥–∞–µ–º 4 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–∞ GPU
cudaStream_t streams[4];
for (int i = 0; i < 4; i++) {
    cudaStreamCreate(&streams[i]);
}

// –¢–µ–ø–µ—Ä—å GPU –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å 4 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!
grayscaleKernel<<<grid, block, 0, streams[0]>>>(...);  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1
grayscaleKernel<<<grid, block, 0, streams[1]>>>(...);  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 2
grayscaleKernel<<<grid, block, 0, streams[2]>>>(...);  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 3
grayscaleKernel<<<grid, block, 0, streams[3]>>>(...);  // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 4
```

**–í—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞:**
```
–í—Ä–µ–º—è ‚Üí
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ó–∞–≥—Ä—É–∑–∫–∞:   [img1][img2][img3][img4][img5][img6]...
GPU:           [img1][img2][img3][img4][img5]...
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:        [img1][img2][img3][img4]...
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
           ‚Üë –í—Å–µ —ç—Ç–∞–ø—ã —Ä–∞–±–æ—Ç–∞—é—Ç –û–î–ù–û–í–†–ï–ú–ï–ù–ù–û!
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- CPU –∏ GPU —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–Ω–µ—Ç –ø—Ä–æ—Å—Ç–æ—è)
- 4 CUDA streams ‚Üí 4 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ GPU –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –£—Å–∫–æ—Ä–µ–Ω–∏–µ: 20-30% –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –æ–±—ã—á–Ω–æ–π –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π

---

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é GPU
```cpp
// –ü–ª–æ—Ö–æ: —á–∞—Å—Ç—ã–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
for (–∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ) {
    cudaMalloc(&gpu_data, size);  // –ú–µ–¥–ª–µ–Ω–Ω–æ!
    // ...
    cudaFree(gpu_data);
}

// –•–æ—Ä–æ—à–æ: –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤
cudaMalloc(&gpu_data, max_size);  // –û–¥–∏–Ω —Ä–∞–∑
for (–∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –±—É—Ñ–µ—Ä
}
cudaFree(gpu_data);  // –û–¥–∏–Ω —Ä–∞–∑ –≤ –∫–æ–Ω—Ü–µ
```

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```cpp
// –ü–ª–æ—Ö–æ: —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
cudaMemcpy(dst, src, size, cudaMemcpyHostToDevice);  // –ë–ª–æ–∫–∏—Ä—É–µ—Ç CPU
kernel<<<...>>>();
cudaMemcpy(dst, src, size, cudaMemcpyDeviceToHost);  // –ë–ª–æ–∫–∏—Ä—É–µ—Ç CPU

// –•–æ—Ä–æ—à–æ: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
cudaMemcpyAsync(dst, src, size, cudaMemcpyHostToDevice, stream);
kernel<<<..., stream>>>();
cudaMemcpyAsync(dst, src, size, cudaMemcpyDeviceToHost, stream);
// CPU –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –¥—Ä—É–≥—É—é —Ä–∞–±–æ—Ç—É!
```

### 3. –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤
```cpp
// –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞: 16√ó16 = 256 –ø–æ—Ç–æ–∫–æ–≤
// - –•–æ—Ä–æ—à–æ –¥–ª—è –∫—ç—à–∞ L1 (shared memory)
// - –î–µ–ª–∏—Ç—Å—è –Ω–∞ —Ä–∞–∑–º–µ—Ä warp (32 –ø–æ—Ç–æ–∫–∞)
// - –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ GPU
dim3 blockSize(16, 16);
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- GPU: NVIDIA RTX 4060 (3072 CUDA cores)
- CPU: 16 –ø–æ—Ç–æ–∫–æ–≤
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: 20 —Ñ–∞–π–ª–æ–≤, ~1280√ó720 –ø–∏–∫—Å–µ–ª–µ–π –∫–∞–∂–¥–æ–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
| –ú–µ—Ç–æ–¥ | –í—Ä–µ–º—è | –£—Å–∫–æ—Ä–µ–Ω–∏–µ |
|-------|-------|-----------|
| CPU (1 –ø–æ—Ç–æ–∫) | ~15 —Å–µ–∫ | 1√ó |
| CPU (16 –ø–æ—Ç–æ–∫–æ–≤) | ~2.5 —Å–µ–∫ | 6√ó |
| GPU + CPU (batch) | ~2.5 —Å–µ–∫ | 6√ó |
| GPU + CPU (pipeline) | ~2.1 —Å–µ–∫ | **7.1√ó** |

**–í—ã–≤–æ–¥:** –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞ —Å—á–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.
